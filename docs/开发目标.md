-----

### **项目需求：macOS 平台代理节点批量测速命令行工具 (CLI)**

**项目标题：**
macOS 平台代理节点批量测速命令行工具

**项目概述：**
我需要一个在 macOS 终端中运行的命令行工具（CLI）。这个工具的核心功能是：接收一个标准的节点订阅链接，自动解析出其中所有的代理节点，然后通过多种模式并发测试这些节点的网络连通性和延迟，最后将结果清晰地展示出来，帮助用户快速找到当前网络环境下最优的节点。

-----

**核心功能需求 (Functional Requirements)：**

1.  **订阅链接处理：**

      * 工具必须能够接收一个 URL 作为输入参数（例如：`proxytester --url "..."`）。
      * 程序需要能通过该 URL 下载订阅内容。
      * 订阅内容通常是 Base64 编码的，程序需要能自动进行解码。

2.  **节点解析：**

      * 解码后的文本内容包含多个独立的节点链接，程序需要能逐行解析。
      * 必须支持解析当前主流的代理协议链接，至少包括：**VLESS**, **VMess**, 和 **Shadowsocks (SS)**。
      * 解析器需要足够健壮，能够准确提取出每个节点的关键信息，如：服务器地址（IP或域名）、端口、UUID/密码、加密方式等。

3.  **并发测速：**

      * 为节省时间，对所有解析出的节点进行测试时，必须采用**并发**（多线程或协程）的方式执行。
      * 最好可以提供一个参数来控制并发任务的数量（例如 `-c 10`，表示同时测试10个节点）。

4.  **多种测速模式：**
    工具需要支持以下三种独立的测试模式，并且能够清晰地返回每种模式的测试结果（主要是延迟时间，单位为毫秒 ms）：

      * **ICMP Ping (`ping`)**：
          * 测试本地到节点服务器IP的**物理线路延迟**。
          * 这能反映最基础的网络可达性。
      * **TCP Ping (`tcping`)**：
          * 测试与节点服务器**指定端口**建立 TCP 连接所需的时间。
          * 这比 ICMP 更能反映节点的**服务端口是否可用**。
      * **真实连接测试 (CONNECT)**：
          * **此为最核心的测试模式。**
          * 模拟客户端，向代理节点发起一个真实的连接请求（例如 HTTP CONNECT 请求）。
          * 测试从请求发起到成功建立代理隧道的时间。这能最准确地反映该**代理服务是否真实有效**。

5.  **结果展示：**

      * 所有节点测试完成后，在终端中打印一个格式清晰的结果表格。
      * 表格应至少包含以下列：节点名称、服务器地址、**TCP延迟**、**真实连接延迟**、状态（成功/失败/超时）。
      * 结果列表应默认**按“真实连接延迟”从低到高排序**，方便用户一眼看到最快的节点。

-----

**技术与环境要求 (Technical Requirements)：**

  * **目标平台：** 仅 macOS。
  * **程序类型：** 纯命令行工具，不需要图形用户界面（GUI）。
  * **语言建议：** 推荐使用 **Go 语言**进行开发。
      * **理由：** Go 语言非常适合开发此类网络工具。其天生的并发支持（Goroutine）能轻松实现高效率的并发测速；强大的标准库能很好地处理网络请求；最重要的是，它可以被编译成一个无任何依赖的单一二进制可执行文件，在 macOS 上分发和使用极为方便。

-----

**使用流程示例 (Example Usage Flow)：**

1.  用户在终端中输入命令：
    ```bash
    ./proxy-tester test --url "https://example.com/mysub"
    ```
2.  程序开始执行：
      * 显示 "正在从 URL 下载订阅..."
      * 显示 "解码成功，发现 50 个节点，开始并发测试..."
      * 显示一个动态更新的进度条。
3.  测试完成后，清屏并打印结果表格：

**输出结果示例 (Example Output Format)：**

```
✅ 测试完成，共 50 个节点，成功 45 个。结果按真实延迟排序：

| 节点名称             | 服务器地址        | TCP延迟 | 真实延迟 | 状态  |
|----------------------|-------------------|---------|----------|-------|
| HK-香港-01           | 1.2.3.4:443       | 85ms    | 120ms    | 成功  |
| JP-东京-BGP          | 5.6.7.8:443       | 110ms   | 155ms    | 成功  |
| SG-新加坡-05         | 9.1.2.3:2053      | 150ms   | 210ms    | 成功  |
| ...                  | ...               | ...     | ...      | ...   |
| US-洛杉矶-GIA        | 4.5.6.7:80        | 250ms   | -        | 超时  |
| DE-德国-02           | 8.9.1.2:443       | -       | -        | 失败  |
```

-----

**加分项 (Bonus Features) - 如果时间和预算允许：**

  * 支持从本地文件导入节点链接 (`--file /path/to/nodes.txt`)。
  * 支持对测试成功的节点进行简单的下载速度测试。
  * 允许用户将测试结果导出为文件（如 CSV 或 JSON 格式）。

-----