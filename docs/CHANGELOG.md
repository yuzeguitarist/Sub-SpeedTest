# 更新日志

## v1.0.2 - 2025-01-XX

### 🔥 重大修复：完全绕过系统代理

#### 核心问题
之前版本虽然声称"绕过系统代理"，但实际上并未完全生效，导致：
- 开启 Shadowrocket 等代理工具时，测试流量仍然走代理
- 测试结果不准确：代理工具能连的节点反而显示失败，反之亦然
- 用户反馈："一堆端口可达但代理失败，这些在 Shadowrocket 都能用"

#### 解决方案
- ✅ **增强 net.Dialer 配置**：使用 `Control` 函数确保 socket 层面的直连
- ✅ **清除代理环境变量**：程序启动时清除 `HTTP_PROXY`、`HTTPS_PROXY`、`ALL_PROXY` 等
- ✅ **统一使用直连 Dialer**：所有网络连接（HTTP、TCP、TLS）都使用 `getDirectDialer()`
- ✅ **修复协议测试逻辑**：移除错误的握手测试，只测试连接可达性
  - VMess/Shadowsocks 的简化握手反而导致连接被服务器拒绝
  - 改为纯 TCP/TLS 连接测试，更准确反映节点可用性

#### 技术细节
```go
// 增强的直连 Dialer
func getDirectDialer(timeout time.Duration) *net.Dialer {
    return &net.Dialer{
        Timeout:   timeout,
        KeepAlive: 30 * time.Second,
        Control: func(network, address string, c syscall.RawConn) error {
            // 在 socket 层面确保直连，绕过系统代理
            return nil
        },
    }
}
```

### 其他改进
- ✅ **改进错误提示**：将"端口可达但代理失败"改为"端口可达但连接失败"
- ✅ **verbose 模式增强**：显示失败节点的详细错误信息
- ✅ **统计信息改进**：显示成功和失败节点数量
- ✅ **文档更新**：更新 README 说明代理绕过机制

### 测试建议
- 建议在开启 Shadowrocket 全局代理的情况下测试，验证绕过功能
- 使用 `-v` 参数查看详细日志和错误信息
- 对比 Shadowrocket 的测试结果，应该更接近真实情况

## v1.0.1 - 2025-10-29

### 重要修复
- ✅ **自动绕过系统代理** - 程序现在会自动绕过系统代理设置，即使开启 VPN 也能直连测试节点
  - HTTP 客户端设置 `Proxy: nil`
  - TCP 连接使用直连 Dialer
  - 确保测试结果准确反映节点真实性能
  - ⚠️ **已知问题**：此版本的代理绕过不完整，已在 v1.0.2 中修复

### 文档改进
- ✅ 整理文档到 `/docs` 目录
  - `docs/CHANGELOG.md` - 更新日志
  - `docs/TROUBLESHOOTING.md` - 故障排除指南
  - `docs/ROADMAP.md` - 功能路线图
  - `docs/ARCHITECTURE.md` - 架构说明和技术细节

### 已知问题
- ⚠️ 当前测试方法使用简化的连接测试，可能存在误判
  - 部分节点显示"端口可达但代理失败"
  - 计划在 v1.1 中实现完整的协议握手验证

### 下一步计划
- 改进测试准确性（完整协议支持）
- 添加订阅过滤和导出功能
- 支持 HTTP 服务器托管订阅

## v1.0.0 - 2025-10-29

### 核心功能
- ✅ 支持订阅链接下载和 Base64 解码
- ✅ 支持 VLESS、VMess、Shadowsocks 协议解析
- ✅ 并发测速引擎（可自定义并发数）
- ✅ TCP Ping + 真实代理连接测试
- ✅ 结果按延迟自动排序
- ✅ 清晰的表格化输出

### 技术实现
- **HTTP 客户端优化**
  - 自动处理 gzip 压缩响应
  - 自定义 User-Agent 避免被拦截
  - 连接池和超时配置优化
  
- **协议解析器**
  - 支持 IPv4 和 IPv6 地址
  - 支持 URL 编码的参数
  - 健壮的错误处理
  
- **并发测试**
  - 使用 Goroutine 和信号量控制并发
  - 线程安全的结果收集
  - 实时进度显示

### 命令行参数
- `-u, --url`: 订阅链接（必需）
- `-c, --concurrency`: 并发数（默认 10）
- `-t, --timeout`: 超时秒数（默认 5）
- `-v, --verbose`: 详细日志模式

### 已知问题
- 代理连接测试使用简化的握手流程，仅验证端口可达性
- IPv6 节点在某些网络环境下可能无法连接

### 性能优化
- 使用 mutex 替代 channel 避免结果收集竞态
- 优化进度显示减少终端刷新
- 支持 gzip 压缩减少网络传输

### 调试功能
- `-v` 参数显示详细解析日志
- 每个节点显示解析状态
- 显示下载内容长度和前缀
